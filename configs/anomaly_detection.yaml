# Anomaly Detection Configuration
# Main configuration file for Hubble Anomaly Detector

application:
  hubble_server: "localhost:4245"
  prometheus_export_url: "8080"
  default_namespace: "default"
  auto_start: false

prometheus:
  url: "http://localhost:9090"
  timeout_seconds: 10
  retry_attempts: 3
  retry_delay_seconds: 5

namespaces:
  - "default"
  - "kube-system"

detection:
  baseline_multiplier: 3.0
  baseline_window_minutes: 1
  check_interval_seconds: 10

rules:
  - name: "traffic_spike"
    enabled: true
    severity: "CRITICAL"
    description: "Ph√°t hi·ªán traffic spike c√≥ th·ªÉ l√† DDoS"
    type: "prometheus"
    thresholds:
      multiplier: 3.0
  
  - name: "new_destination"
    enabled: true
    severity: "HIGH"
    description: "Ph√°t hi·ªán k·∫øt n·ªëi ƒë·∫øn destination m·ªõi"
    type: "prometheus"
  
  - name: "tcp_reset_surge"
    enabled: true
    severity: "HIGH"
    description: "Ph√°t hi·ªán surge TCP resets"
    type: "prometheus"
    thresholds:
      per_minute: 10
  
  - name: "tcp_drop_surge"
    enabled: true
    severity: "HIGH"
    description: "Ph√°t hi·ªán surge TCP drops"
    type: "prometheus"
    thresholds:
      per_minute: 10
  
  - name: "high_bandwidth"
    enabled: true
    severity: "MEDIUM"
    description: "Ph√°t hi·ªán bandwidth cao b·∫•t th∆∞·ªùng"
    type: "prometheus"
    thresholds:
      bytes_per_second: 1000000
  
  - name: "unusual_port_scan"
    enabled: true
    severity: "HIGH"
    description: "Ph√°t hi·ªán port scanning"
    type: "prometheus"
    thresholds:
      ports_per_minute: 50

alerting:
  enabled: true
  max_alerts_per_minute: 10
  alert_cooldown_seconds: 60
  channels:
    log: true
    webhook: false
    email: false
    telegram: true
  
  telegram:
    bot_token: "8218813054:AAHsOPfSXpnBgQaUS52naFavJUWafKxYqmQ"
    chat_id: "5037781514"
    parse_mode: "Markdown"
    enabled: true
    message_template: |
      üö® *{{ .Severity }} Alert*
      
      *Type:* {{ .Type }}
      *Time:* {{ formatTime .Timestamp "2006-01-02 15:04:05" }}
      *Message:* {{ .Message }}
      
      {{ if and .FlowData .FlowData.Source }}
      *Source:* {{ .FlowData.Source.Namespace }}/{{ .FlowData.Source.PodName }}
      {{ end }}
      {{ if and .FlowData .FlowData.Destination }}
      *Destination:* {{ .FlowData.Destination.Namespace }}/{{ .FlowData.Destination.PodName }}
      {{ end }}

logging:
  level: "INFO"
  format: "json"
  file_path: "/var/log/anomaly-detector.log"

