# Default values for hubble-guard
# This is a YAML-formatted file.

# Application configuration
application:
  hubble_server: "hubble-relay.kube-system.svc.cluster.local:80"
  prometheus_export_url: "8080"
  default_namespace: "default"

# Prometheus configuration (for anomaly detector to connect to)
# Note: URL will be dynamically set based on service name
prometheusConfig:
  url: ""  # Will be set to http://<prometheus-service-name>:9090
  timeout_seconds: 10
  retry_attempts: 3
  retry_delay_seconds: 5

# Namespaces to monitor
namespaces:
  - "default"

# Detection configuration
detection:
  baseline_multiplier: 3.0
  baseline_window_minutes: 1
  check_interval_seconds: 10

# Rules configuration
rules:
  - name: "ddos"
    enabled: true
    severity: "CRITICAL"
    description: "Phát hiện DDoS attack real-time"
    thresholds:
      multiplier: 10.0
  
  - name: "traffic_death"
    enabled: true
    severity: "CRITICAL"
    description: "Phát hiện khi traffic rate = 0 nhưng trước đó có baseline, cảnh báo service có thể đã chết"
  
  - name: "port_scan"
    enabled: false
    severity: "HIGH"
    description: "Phát hiện port scanning attacks"
    thresholds:
      distinct_ports: 20
  
  - name: "namespace_access"
    enabled: true
    severity: "HIGH"
    description: "Phát hiện truy cập trái phép đến namespace nhạy cảm"
    thresholds:
      forbidden_namespaces:
        - "monitoring"
        - "security"
        - "test-demo"

  - name: "suspicious_outbound"
    enabled: true
    severity: "HIGH"
    description: "Cảnh báo ngay khi phát hiện kết nối outbound đến các port nguy hiểm: Telnet (23), RPC (135), SMB (445), SQL Server (1433), MySQL (3306), PostgreSQL (5432)"
  
  - name: "traffic_spike"
    enabled: true
    severity: "CRITICAL"
    description: "Phát hiện traffic spike có thể là DDoS (từ Prometheus)"
    thresholds:
      multiplier: 3.0

  - name: "block_connection"
    enabled: true
    severity: "HIGH"
    description: "Phát hiện DROP flows"
    thresholds:
      per_minute: 10

  - name: "unusual_traffic"
    enabled: true
    severity: "HIGH"
    description: "Phát hiện traffic bất thường"
    thresholds:
      allowed_sources:
        demo-api:
          - "demo-frontend"

# Alerting configuration
alerting:
  enabled: true
  max_alerts_per_minute: 10
  alert_cooldown_seconds: 60
  channels:
    log: true
    webhook: false
    email: false
    telegram: true
  
  telegram:
    bot_token: "8218813054:AAHsOPfSXpnBgQaUS52naFavJUWafKxYqmQ"
    chat_id: "5037781514"
    parse_mode: ""
    enabled: true
    message_template: ""

# Logging configuration
logging:
  level: "INFO"
  format: "json"
  file_path: "/var/log/anomaly-detector.log"

# Anomaly Detector configuration
anomalyDetector:
  replicaCount: 1
  
  image:
    repository: docker.io/ramseytrinh338/hubble-guard
    pullPolicy: IfNotPresent
    tag: "latest"
  
  imagePullSecrets: []
  
  podAnnotations: {}
  
  podSecurityContext: {}
  
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop:
      - ALL
  
  resources:
    limits:
      cpu: 1000m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  nodeSelector: {}
  
  tolerations: []
  
  affinity: {}
  
  service:
    type: ClusterIP
    port: 8080
    annotations: {}
  
  serviceAccount:
    create: true
    annotations: {}
    name: ""

# API Server configuration
apiServer:
  enabled: true
  replicaCount: 1
  
  image:
    repository: docker.io/ramseytrinh338/hubble-guard-api
    pullPolicy: IfNotPresent
    tag: "latest"
  
  imagePullSecrets: []
  
  podAnnotations: {}
  
  podSecurityContext: {}
  
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop:
      - ALL
  
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  nodeSelector: {}
  
  tolerations: []
  
  affinity: {}
  
  service:
    type: ClusterIP
    port: 5001
    annotations: {}
  
  serviceAccount:
    create: true
    annotations: {}
    name: ""

# Prometheus configuration
prometheus:
  replicaCount: 1
  
  image:
    repository: prom/prometheus
    tag: "v3.7.3"
    pullPolicy: IfNotPresent
  
  imagePullSecrets: []
  
  podAnnotations: {}
  
  podSecurityContext: {}
  
  securityContext: {}
  
  scrapeInterval: "15s"
  evaluationInterval: "15s"
  retention: "15d"
  
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  
  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""
  
  nodeSelector: {}
  
  tolerations: []
  
  affinity: {}
  
  service:
    type: ClusterIP
    port: 9090
    annotations: {}

# Grafana configuration
grafana:
  replicaCount: 1
  
  image:
    repository: grafana/grafana
    tag: "11.0.0"
    pullPolicy: IfNotPresent
  
  imagePullSecrets: []
  
  podAnnotations: {}
  
  podSecurityContext: {}
  
  securityContext: {}
  
  adminUser: "admin"
  adminPassword: "admin"
  rootUrl: ""
  plugins: ""
  
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  persistence:
    enabled: false
    size: 10Gi
    storageClass: ""
  
  nodeSelector: {}
  
  tolerations: []
  
  affinity: {}
  
  service:
    type: ClusterIP
    port: 3000
    annotations: {}

# UI configuration
ui:
  enabled: true
  replicaCount: 1
  
  image:
    repository: docker.io/ramseytrinh338/hubble-guard-ui
    tag: "latest"
    pullPolicy: Always
  
  imagePullSecrets: []
  
  podAnnotations: {}
  
  podSecurityContext: {}
  
  securityContext: {}
  
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi
  
  nodeSelector: {}
  
  tolerations: []
  
  affinity: {}
  
  service:
    type: ClusterIP
    port: 80
    annotations: {}
  
  ingress:
    enabled: false
    className: "nginx"
    annotations: {}
    hosts:
      - host: hubble-guard-ui.local
        paths:
          - path: /
            pathType: Prefix
    tls: []

# Global settings
nameOverride: ""
fullnameOverride: ""

